<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Uber é«˜æ€§èƒ½ Web App ä¼˜åŒ–å®è·µ- cool4zbl</title>
    <meta name="description" content="åŸæ–‡ Building m.uber: ENGINEERING A HIGH-PERFORMANCE WEB APP FOR THE GLOBAL MARKET Performance matters on mobile. åˆæ˜¯ä¸€ç¯‡å…³äºæ€§èƒ½ä¼˜åŒ–çš„å®è·µã€‚ m.uber å›¢é˜Ÿå¯¹ m.uberï¼Œä»–ä»¬çš„è¶…çº§è½»é‡ web app åšäº†ä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„å·¥ä½œã€‚ èŒƒå›´å…¨é¢ï¼Œä»ä»£ç åˆ°æ‰“åŒ…åˆ°éƒ¨ç½²åˆ°ç¼“å­˜ï¼Œéƒ½æœ‰æ¶‰åŠã€‚ TL;DR Performance Tools Preact over React Webpack  dynamic bundle splitting &amp;amp; tree-shaking capabilities  Tiny Libraries &amp;amp; Minimal Dependencies source-map-explorer ä¸‹é¢æ˜¯æ­£æ–‡ï¼š Smaller, faster: how we built it æŠ€æœ¯æ ˆ ä»£ç å±‚é¢ï¼šES2015+ï¼Œä½¿ç”¨ Babel ç¼–è¯‘ï¼› æ¡†æ¶ï¼šPreact + Webpackï¼› è®¾è®¡çš„ç—›ç‚¹æ˜¯ï¼Œåœ¨ä¿è¯ç±» Native App ä¸°å¯Œä½“éªŒçš„åŒæ—¶ï¼Œæœ€å°åŒ–å®¢æˆ·ç«¯ä½“ç§¯ã€‚æ‰€ä»¥ Preact + Webpack çš„ dynamic bundle splitting å’Œ tree-shaking capabilities  åŠŸèƒ½å®Œç¾æ­é…ã€‚ Initial server render é¦–æ¬¡æœåŠ¡ç«¯æ¸²æŸ“ å› ä¸ºåœ¨æ‰€æœ‰æ ¸å¿ƒæ‰“åŒ…çš„ JS å…¨éƒ¨è¢«ä¸‹è½½å‰ï¼Œå®¢æˆ·ç«¯æˆ–æµè§ˆå™¨éƒ½ä¸èƒ½å¼€å§‹æ¸²æŸ“ markup æ ‡è®°ã€‚ ä¸ºäº†æ›´å¿«é¦–å±æ¸²æŸ“ï¼Œm.uber åœ¨é¦–æ¬¡æµè§ˆå™¨è¯·æ±‚æ—¶å€™ä¼šè¿”å›æœåŠ¡ç«¯æ¸²æŸ“å¥½çš„ Preactï¼Œä¸” statetech,frontend,optimization" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#d55b6a">
    <meta name="theme-color" content="#ffffff">


    <link rel="stylesheet" type="text/css"
        href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />

    <link rel="stylesheet" type="text/css" href="/assets/built/hl-styles/atom-one-dark.css" />


    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Doodles" href="/rss/index.xml">
<link rel="canonical" href="http://zhangbinliu.me/2017-07-10-m-uber-performance-optimazation/" />
</head>

<body class="author-template author- post-template tag-tech tag-frontend tag-optimization nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-tech tag-frontend tag-optimization">

        <header class="post-header">
            <h1 class="post-title">Uber é«˜æ€§èƒ½ Web App ä¼˜åŒ–å®è·µ</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-07-10">10 July 2017</time>  on <a href="/tag/tech/">tech</a>, <a href="/tag/frontend/">frontend</a>, <a href="/tag/optimization/">optimization</a>
            </section>
        </header>


        <section class="post-content">
          <p>åŸæ–‡ <a href="https://eng.uber.com/m-uber/">Building m.uber: ENGINEERING A HIGH-PERFORMANCE WEB APP FOR THE GLOBAL MARKET</a></p>
<p><strong>Performance matters on mobile.</strong></p>
<p>åˆæ˜¯ä¸€ç¯‡å…³äºæ€§èƒ½ä¼˜åŒ–çš„å®è·µã€‚</p>
<p>m.uber å›¢é˜Ÿå¯¹ m.uberï¼Œä»–ä»¬çš„è¶…çº§è½»é‡ web app åšäº†ä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„å·¥ä½œã€‚</p>
<p>èŒƒå›´å…¨é¢ï¼Œä»ä»£ç åˆ°æ‰“åŒ…åˆ°éƒ¨ç½²åˆ°ç¼“å­˜ï¼Œéƒ½æœ‰æ¶‰åŠã€‚</p>
<h2 id="tl-dr">TL;DR</h2>
<h3 id="performance-tools">Performance Tools</h3>
<ul>
<li>Preact over React</li>
<li>Webpack  <a href="https://webpack.js.org/guides/code-splitting-async/">dynamic bundle splitting</a> &amp; <a href="https://webpack.js.org/guides/tree-shaking/">tree-shaking capabilities </a></li>
<li>Tiny Libraries &amp; Minimal Dependencies</li>
<li><a href="https://www.npmjs.com/package/source-map-explorer">source-map-explorer</a></li>
</ul>
<p>ä¸‹é¢æ˜¯æ­£æ–‡ï¼š</p>
<h3 id="smaller-faster-how-we-built-it">Smaller, faster: how we built it</h3>
<h4 id="-">æŠ€æœ¯æ ˆ</h4>
<p>ä»£ç å±‚é¢ï¼šES2015+ï¼Œä½¿ç”¨ Babel ç¼–è¯‘ï¼›</p>
<p>æ¡†æ¶ï¼š<code>Preact</code> + <code>Webpack</code>ï¼›</p>
<p>è®¾è®¡çš„ç—›ç‚¹æ˜¯ï¼Œåœ¨ä¿è¯ç±» Native App ä¸°å¯Œä½“éªŒçš„åŒæ—¶ï¼Œæœ€å°åŒ–å®¢æˆ·ç«¯ä½“ç§¯ã€‚æ‰€ä»¥ Preact + <a href="https://webpack.github.io/">Webpack</a> çš„ <a href="https://webpack.js.org/guides/code-splitting-async/">dynamic bundle splitting</a> å’Œ <a href="https://webpack.js.org/guides/tree-shaking/">tree-shaking capabilities </a> åŠŸèƒ½å®Œç¾æ­é…ã€‚</p>
<h4 id="initial-server-render-">Initial server render é¦–æ¬¡æœåŠ¡ç«¯æ¸²æŸ“</h4>
<p>å› ä¸ºåœ¨æ‰€æœ‰æ ¸å¿ƒæ‰“åŒ…çš„ JS å…¨éƒ¨è¢«ä¸‹è½½å‰ï¼Œå®¢æˆ·ç«¯æˆ–æµè§ˆå™¨éƒ½ä¸èƒ½å¼€å§‹æ¸²æŸ“ markup æ ‡è®°ã€‚</p>
<p>ä¸ºäº†æ›´å¿«é¦–å±æ¸²æŸ“ï¼Œm.uber åœ¨é¦–æ¬¡æµè§ˆå™¨è¯·æ±‚æ—¶å€™ä¼šè¿”å›æœåŠ¡ç«¯æ¸²æŸ“å¥½çš„ Preactï¼Œä¸” <code>state</code> åŠ <code>markup</code> éƒ½åµŒåˆ°è¡Œå†…ï¼Œå…¨éƒ¨éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™äº›å†…å®¹ä¸€æ—¦è¢«å®¢æˆ·ç«¯ä¸‹è½½ï¼Œå°±å¯ä»¥ç«‹é©¬åŠ è½½å‡ºæ¥ã€‚</p>
<h4 id="serve-bundles-on-demand-">Serve bundles on demand æŒ‰éœ€æ‰“åŒ…åŠ è½½</h4>
<p>m.uber ä¸­å¤§éƒ¨åˆ† JS éƒ½æ˜¯ç”¨æ¥åšä¸€äº›è¾…åŠ©åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯æ²¡æœ‰å¿…è¦ä¸€æ¬¡æ€§åŠ è½½çš„ï¼Œæ‰€ä»¥ä»–ä»¬ç”¨äº† Webpack çš„ <code>Code Splitting</code> å·¥å…·æŒ‰éœ€åŠ è½½ä»£ç ã€‚</p>
<p>ï¼ˆè¿™ä¸ªæˆ‘åœ¨ Accounts é¡¹ç›®ä¹Ÿå®è·µè¿‡ï¼Œä¸€ä¸ªå·¨å¤§çš„ JS æ–‡ä»¶æ‹†åˆ†æˆäº†ä¸‰ä¸ªå°çš„ JS æ–‡ä»¶ï¼Œä¸è¿‡ä¹Ÿéœ€è¦è€ƒè™‘æ¯ä¸ª HTTP è¯·æ±‚æ—¶é—´ã€‚ï¼‰</p>
<blockquote>
<p>We use a <em>splitPage</em> function that returns the ancillary bundle wrapped in an asynchronous component.</p>
</blockquote>
<pre class="hljs"><code><span class="hljs-comment">// Example: settings page</span>
<span class="hljs-keyword">const</span> AsyncSettings = splitPage(
 {load: () =&gt; <span class="hljs-preprocessor"><span class="hljs-keyword">import</span>(â€˜../../screens/settingsâ€™)}
);</span>

<span class="hljs-comment">// å½“ä¸”ä»…å½“ <code>AsyncSettings</code> è¢« Parent Component render() è°ƒç”¨ï¼Œ</span>
<span class="hljs-comment">// setting bundle js æ‰ä¼šè¢«ä¸‹è½½.</span></code></pre><h4 id="tiny-libraries-">Tiny Libraries æ›´å°çš„åº“</h4>
<p>m.uber æœ¬æ„ä¸Šæ˜¯å¸Œæœ›åœ¨ 2G ç½‘ä¸‹ä¹Ÿèƒ½é£å¿«ï¼Œæ‰€ä»¥æ‰“åŒ…åçš„ä½“ç§¯ä¹Ÿå¾ˆé‡è¦ã€‚</p>
<p>ä»–ä»¬ App æ ¸å¿ƒéƒ¨åˆ†ï¼ˆå«è½¦åŠŸèƒ½ï¼‰åœ¨ gzipped &amp; minified ååªæœ‰ 50kB å¤§å°ï¼Œæ‰€ä»¥åœ¨å…¸å‹ 2G ç½‘ï¼ˆ50kB/s, 500ms å»¶æ—¶ï¼‰ä¸‹ï¼Œä¹Ÿèƒ½ä¸‰ç§’å†…å¼€å§‹äº¤äº’ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–å‰åçš„æ‰“åŒ…å’Œä¾èµ–çš„å¯¹æ¯”ã€‚</p>
<p><img src="https://eng.uber.com/wp-content/uploads/2017/06/image4-3.png" alt="bundle size"></p>
<p>â€‹</p>
<h4 id="preact-over-react">Preact over React</h4>
<p>ä½“ç§¯åŸå› ï¼Œ Preact (3kB GZip/minified)  &lt; React (45kB).</p>
<p>Preact é™¤äº†ä¸æ”¯æŒ <code>PropTypes</code> å’Œåˆæˆäº‹ä»¶å¤–ï¼Œè¿˜æ˜¯å¯ä»¥çš„ã€‚</p>
<p>Preact æ®è¯´åœ¨ç»„ä»¶å’Œå…ƒç´ å›æ”¶å¯èƒ½æœ‰ç‚¹ç‚¹é—®é¢˜ï¼Œä¸è¿‡ä»–ä»¬è¿˜æ˜¯æ­£åœ¨è§£å†³çš„å§... åæ­£ uber çš„äººè§‰å¾—ä»–ä»¬ç”¨ç€è¿˜ä¸é”™ã€‚</p>
<h4 id="minimal-dependencies-">Minimal Dependencies æœ€å°åŒ–ä¾èµ–</h4>
<p>ä¸ºäº†å¯¹ä»˜å‰ç«¯æ‰“åŒ…ä¸€ä¸ªæ˜æ˜¾çš„<strong>ä¾èµ–è†¨èƒ€ï¼ˆdependency bloatï¼‰</strong>ï¼ŒUber çš„äººå¯¹å®‰è£…çš„ npm åŒ…ç‰¹åˆ«æŒ‘å‰”ã€‚</p>
<p>ä»–ä»¬æ¨èä½¿ç”¨ <code>Just</code> é‚£ä¸ªåŒ…ï¼Œæˆ–è€…å‚è€ƒå®ƒçš„ npm package æ€æƒ³ï¼šä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œä¸”æ— å…¶ä»–ä»»ä½•ä¾èµ–ã€‚ï¼ˆå» Just GitHub çœ‹ï¼ŒåŒ…ä½œè€…å°±æ˜¯å†™è¿™ç¯‡æ–‡ç« çš„äºº...ï¼‰</p>
<p>ä¸æœåŠ¡å™¨ç«¯è¿›è¡Œæ•°æ®ä¼ è¾“ä»£ä»·é«˜æ˜‚ï¼Œæ‰€ä»¥ä¸€äº›ç‰¹åˆ«å¤§çš„åº“ï¼Œæ¯”å¦‚ <code>Moment</code> è¿™ç§è¶…å¤§çš„åº“å°±æ˜¯ä¸éœ€è¦è¢«ä¸‹è½½çš„ï¼ˆä½†æ˜¯æˆ‘åœ¨æƒ³çš„æ˜¯ï¼Œä»–ä»¬æ˜¯è‡ªå·±å®ç°äº†ä¸€å¥—ç±»ä¼¼ Moment çš„ä¸œè¥¿å—ï¼Ÿï¼‰</p>
<p>æ¨èäº† <a href="https://www.npmjs.com/package/source-map-explorer">source-map-explorer</a>  å·¥å…·æ¥åˆ†æåŠ è½½çš„ä¾èµ–ã€‚è¿™æ ·çš„è¯èƒ½å¾ˆç›´è§‚çš„çŸ¥é“ä»¥åä»å“ªå—å¼€å§‹è¿›è¡Œä»£ç å±‚é¢çš„ä¼˜åŒ–ã€‚</p>
<p>äºæ˜¯æˆ‘ç”¨è¿™ä¸ªå·¥å…·æ¥åˆ†æäº†ä¸‹è‡ªå·±çš„é¡¹ç›® <code>creator-main-js</code>ã€‚</p>
<p><img src="/content/images/m_uber/creator-js-source-map-explorer.png" alt="creator-js-source-map-explorer"></p>
<h4 id="conditional-feature-set">Conditional Feature Set</h4>
<p>é¦–æ¬¡åŠ è½½ä¼šè°ƒç”¨ <code>window.performance</code> APIï¼Œç„¶ååŸºäºç»“æœæ¥è€ƒè™‘åœ¨è¯¥è®¾å¤‡ä¸Šæ˜¯åŠ è½½è¿˜æ˜¯éšè—äº¤äº’åœ°å›¾ã€‚</p>
<p>ç›¸å½“äºæ˜¯æ¸è¿›å¢å¼ºçš„æ€æƒ³å§ã€‚</p>
<h4 id="minimal-render-calls">Minimal render Calls</h4>
<p>å’Œ React ä¸€æ ·ï¼ŒPreact æ¯æ¬¡ <code>render</code> Virtual DOM éƒ½æ˜¯æœ‰ä»£ä»·çš„ã€‚</p>
<p>æ‰€ä»¥ä¼˜åŒ–æ–¹æ³•ä¹Ÿå’Œ React ä¸€æ ·ï¼Œå°½å¯èƒ½åœ°å¤šç”¨ <code>shouldComponentUpdate</code> æœ€å°åŒ– <code>render</code> çš„è°ƒç”¨ã€‚</p>
<h4 id="caching">Caching</h4>
<h5 id="service-workers">Service Workers</h5>
<p>åˆè§ service workersï¼Œæˆªè· URL è¯·æ±‚ï¼Œä¿®æ”¹ç½‘ç»œå’Œæœ¬åœ°ç£ç›˜èµ„æºè·å–å˜ä¸ºé…ç½®å¥½çš„è·å–é€»è¾‘ã€‚</p>
<p>Uber æŠŠé¦–æ¬¡ HTML å“åº”å’Œ JS åŒ…éƒ½ç”¨ SW ç¼“å­˜äº†ï¼Œæ‰€ä»¥å°±ç®—é—´æ­‡æ€§æ–­ç½‘ m.uber ä¹Ÿè¿˜æ˜¯èƒ½æ¸²æŸ“å†…å®¹ã€‚</p>
<p>SW ä¹Ÿæå¤§ç¨‹åº¦ä¸Šé™ä½äº†åŠ è½½æ—¶é—´ã€‚ ç£ç›˜ I/O æ€§èƒ½åœ¨ä¸åŒçš„ OS å’Œè®¾å¤‡ä¸Šéƒ½å¾ˆä¸ä¸€æ ·ï¼Œå°±ç®—ä»ç£ç›˜ç¼“å­˜æ‹¿æ•°æ®ä¹Ÿæ˜¯<a href="https://github.com/w3c/ServiceWorker/blob/master/implementation_considerations.md#racing-allowed">ç‰¹åˆ«æ…¢</a>ã€‚SW æ”¯æŒä»æµè§ˆå™¨ç¼“å­˜åŠ è½½æ‰€æœ‰å†…å®¹ã€‚</p>
<p>m.uber å®¢æˆ·ç«¯åœ¨æ¯æ¬¡ build åéƒ½ä¼šå®‰è£…ä¸€ä¸ªæ–°çš„ SWã€‚</p>
<p>Webpack æ¯æ¬¡éƒ½ä¼šç”ŸæˆåŠ¨æ€æ‰“åŒ…åï¼Œbuild ç¯èŠ‚ä¼šæŠŠæ–°çš„æ‰“åŒ…åç›´æ¥å†™åˆ° service worker æ¨¡å—é‡Œé¢ã€‚</p>
<p>ä¸€æ—¦å®‰è£…ï¼Œä¼šé¦–å…ˆç¼“å­˜æ ¸å¿ƒ JS åº“ï¼Œç„¶å lazy-loading ç¼“å­˜ HTML åŠä¸€äº›è¾…åŠ©çš„æŒ‰éœ€åŠ è½½çš„ JS åŒ…ã€‚</p>
<h5 id="local-storage">Local Storage</h5>
<p>Uber çš„äººè§‰å¾—æ¯æ¬¡æŠŠç»å¸¸å˜åŒ–çš„å“åº”æ•°æ®ç¼“å­˜åˆ° SW ä¸å¤ªå¥½ï¼Œä»–ä»¬å°±æŠŠè¿™äº›éƒ½æ‰”åˆ°äº†æµè§ˆå™¨ <code>localStorage</code>.</p>
<p>m.uber æ¯éš”å‡ ç§’å°±ä¼šä»æœåŠ¡å™¨ç«¯æ‹‰ ride statusï¼Œå†æŠŠè¿™äº›æœ€æ–°çš„ status data éƒ½æ”¾åœ¨ <code>localStorage</code> ä¸­ï¼Œå½“ä¹˜å®¢è¿”å› App æ—¶å€™ï¼Œå°±èƒ½ç«‹é©¬é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œè€Œä¸éœ€è¦ç­‰å¾… API é“¾è·¯è€—æ—¶ã€‚</p>
<p>æ¯æ¬¡çš„ status data å¾ˆå°ä¸”ä½“ç§¯æœ‰é™ï¼Œæ‰€ä»¥å­˜å‚¨çš„æ›´æ–°å¾ˆå¿«ï¼Œå¯ä¾èµ–æ€§ä¹Ÿå¥½ã€‚</p>
<p>ä»–ä»¬æœ€åç»ˆäºæ„è¯†åˆ°ï¼Œå…¶å®å¹¶ä¸éœ€è¦ç±»ä¼¼ <code>indexedDB</code> è¿™æ ·çš„æœ¬åœ°å¼‚æ­¥å­˜å‚¨ APIã€‚</p>
<h4 id="styling">Styling</h4>
<h5 id="styletron">Styletron</h5>
<p>m.uber çš„æ ·å¼éƒ½æ˜¯ç”¨çš„ css-in-jsï¼Œå†™æˆäº† JS å¯¹è±¡å½¢å¼ï¼Œæ”¾åœ¨æ¯ä¸ªç»„ä»¶ä¸­ã€‚</p>
<p>ä»–ä»¬ä½¿ç”¨äº† <a href="https://github.com/rtsao/styletron">Styletron</a> åŠ¨æ€ç”Ÿæˆæ ·å¼ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥åƒ JS ä¸€æ ·ï¼Œæ›´çµæ´»åœ°åŠ¨æ€æ‰“åŒ…åˆ‡å‰²ã€å¼‚æ­¥åŠ è½½æ ·å¼ã€‚</p>
<p>Styletron å¯ä»¥é€šè¿‡åˆ›å»ºåŸå­æ ·å¼(atomic stylesheet)ï¼Œå‡å°‘é‡å¤çš„æ ·å¼å£°æ˜ï¼Œæ€§èƒ½å¥½åƒä¹Ÿä¸é”™ï¼Œ <a href="https://github.com/necolas/react-native-web/tree/master/benchmarks">best-in-class rendering performance</a>. ã€‚</p>
<p>è¿™ä¸ªå€’æ˜¯å¯ä»¥è€ƒè™‘å¼„ä¸‹ï¼Œ<code>create-react-app</code> è²Œä¼¼ä¸æ”¯æŒ <code>css-in-modules</code> è¿™ç§æ–¹å¼ã€‚æˆ‘è‡ªå·±çš„è„šæ‰‹æ¶<a href="https://github.com/cool4zbl/rocket">Rocket</a> å‚è€ƒ <code>arc</code> çš„ <strong>Atomic</strong> æ€æƒ³ï¼Œä½¿ç”¨äº† <code>styled-component</code>ï¼Œä¸è¿‡çœ‹ä¸Šé¢é‚£ä¸ªå¯¹æ¯”ï¼Œæ€§èƒ½å¥½åƒæœ‰ç‚¹ä½ã€‚</p>
<h5 id="svgs">SVGs</h5>
<blockquote>
<p>Used <a href="https://github.com/svg/svgo">SVGO</a> together with manual optimizations to further shorten the paths.</p>
<p>Replace polylines with basic shapes.</p>
<p>View box dimensions with suitable divisors to avoid expensive decimals in paths.</p>
</blockquote>
<p>ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå¯¹äºå›¾æ ‡å½¢å¼çš„å›¾ç‰‡å°½é‡ç”¨ SVG æ ¼å¼ï¼Œç„¶ååœ¨ <code>render</code> æ–¹æ³•ä¸­å¼•å…¥å®ƒä»¬ã€‚</p>
<p>ä½¿ç”¨ <a href="https://github.com/svg/svgo">SVGO</a>ã€å¤šä½¿ç”¨ç®€å•å›¾å½¢ã€view box ä½¿ç”¨åˆé€‚çš„ç»´åº¦é¿å…æ˜‚è´µçš„æ•°å­¦è®¡ç®—å¼€é”€ã€‚</p>
<p>æ•´ä¸ª App ä½“ç§¯ä¸‹é™æ˜æ˜¾ï¼</p>
<h5 id="fonts">Fonts</h5>
<p>è°¨æ…ä½¿ç”¨å­—ä½“å¤§å°å’Œé¢œè‰²ï¼Œå…¶å®å¯ä»¥å®Œå…¨å‡å°‘è‡ªå®šä¹‰å­—ä½“ï¼Œä¸ç”¨å‘è§†è§‰è®¾è®¡å¦¥åäº†ã€‚</p>
<h4 id="error-handling">Error Handling</h4>
<ul>
<li>æ²¡æœ‰ä½¿ç”¨å¾ˆå¤§çš„é”™è¯¯ç›‘æ§çš„åº“ï¼Œè€Œæ˜¯æ‹“å±•äº† <code>window.onerror</code> ï¼Œå‘æœåŠ¡å™¨ç«¯å‘é€å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯ã€‚</li>
<li>ç»™ Preact <code>render</code> &amp; <code>shouldComponentUpdate</code> æ–¹æ³•åŒ…äº†ä¸€å±‚ï¼Œæ£€æµ‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³•é”™è¯¯ã€‚</li>
<li>å› ä¸ºè¿™æ ·çš„è®¾è®¡ï¼Œæ‰€ä»¥ CDN-hosted æ–‡ä»¶æŠ›å‡ºæ¥çš„é”™è¯¯å¹¶ä¸ä¼šç»™ <code>window.onerror</code> æä¾›ä»€ä¹ˆæœ‰æ•ˆä¿¡æ¯ï¼Œé™¤éæ­£ç¡®è®¾ç½® CORS å¤´éƒ¨ã€‚ä½†å°±ç®—æ˜¯è®¾ç½®äº† CORSï¼Œå¼‚æ­¥äº‹ä»¶å‘ç”Ÿçš„é”™è¯¯è¿˜æ˜¯å¹¶ä¸èƒ½è¢«è·Ÿè¸ªåˆ°ã€‚äºæ˜¯ä»–ä»¬æŠŠæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬éƒ½åŒ…äº†ä¸€å±‚ï¼Œå…è®¸é”™è¯¯é€šè¿‡ <code>try/catch</code> ä¼ åˆ°çˆ¶æ¨¡å—ã€‚</li>
</ul>
<h3 id="next-steps">Next Steps</h3>
<p>æ„Ÿè§‰ Uber å¯¹äº UX çœŸçš„æ˜¯åšäº†å¤§é‡çš„å·¥å¤«ï¼Œä½†æ˜¯ä»–ä»¬å¹¶æ²¡æœ‰å› æ­¤è€Œåœæ­¢æ­¥ä¼ã€‚</p>
<ul>
<li>æ­£æ‰“ç®—ç¡®å®šä¸€ä¸ªæ–¹æ¡ˆï¼šç»„ä»¶ä»…ä»…æ¥å—æ‰å¹³åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œæ•°ç»„ç±»å‹é›†åˆå±æ€§ï¼Œæœ€å°åŒ– <code>render</code>è°ƒç”¨ã€‚è¿™æ ·çš„è¯å°±å¯ä»¥ç”¨ <code>React.pureComponent</code> ï¼ˆè¿™é‡Œè‡ªåŠ¨åŒ…å«äº† <code>SCU</code>ï¼‰ã€‚<code>render</code>æ–¹æ³•ä¹Ÿå¯ä»¥ä¸“æ³¨äºç”Ÿæˆ HTML markupï¼Œè€Œä¸éœ€è¦å¤„ç†ä¸€å¤§å †é€»è¾‘å’Œå…¶ä»–æ²¡ä»€ä¹ˆæ„ä¹‰çš„ä»»åŠ¡ã€‚æŠŠ API å“åº”è½¬æ¢ä¸ºæ‰å¹³çš„èƒ½è¢«æœåŠ¡ç«¯é€»è¾‘ä»£ç†çš„åŸºæœ¬æ•°æ®ç»“æ„ (see <a href="https://github.com/paularmstrong/normalizr">normalizr</a>) ï¼Œæˆ–è€…ç”¨ <code>mapStateToProps</code>ã€‚<del>ç¥å¥‡çš„æ˜¯ï¼ŒCreator é¡¹ç›®çš„ <code>WorkStore</code> ä¹Ÿç”¨äº†ç±»ä¼¼ normalizr çš„æ•°æ®ç»“æ„å­˜å‚¨</del>ï¼ˆåæ¥ä¸ºäº†æ–¹ä¾¿ç»´æŠ¤è¿˜æ˜¯æ”¹ç”¨äº† Redux...ï¼‰ã€‚</li>
<li>æŠŠ <code>actions</code> &amp; <code>reducers</code> ç»“åˆèµ·æ¥ï¼Œæ›´å®¹æ˜“åˆ†å¼€æ‰“åŒ…ã€‚</li>
<li>å¯¹æ‰€æœ‰è¯·æ±‚ä½¿ç”¨  <a href="https://en.wikipedia.org/wiki/HTTP/2">HTTP/2</a>  ï¼Œç”¨ push notifications ä»£æ›¿ polling APIs.</li>
<li>å¦å¤–ï¼ŒUber äººæ­£åœ¨è€ƒè™‘æŠŠ m.uber çš„æ¶æ„æŠ½è±¡å‡ºä¸€ä¸ªå¼€æºæ¶æ„ï¼Œæˆä¸ºæœªæ¥è½»é‡çº§ Uber Web Appçš„åŸºç¡€ã€‚è¿™è®©æˆ‘æƒ³èµ·äº†ä¹‹å‰çœ‹è¿‡çš„ <a href="https://github.com/DDFE/DDFE-blog/issues/4">æ»´æ»´ Web App æ¶æ„</a>ï¼ŒåŒæ ·æ˜¯æ‰“è½¦è½¯ä»¶ï¼Œæ»´æ»´ FE team åœ¨ Web App æ¶æ„ä¸Šä¹Ÿæ˜¯åšäº†å¤§é‡å·¥å¤«ï¼Œå€¼å¾—å‚è€ƒå­¦ä¹ ã€‚</li>
</ul>
<p>çºµè§‚è¿™äº›æ–¹æ¡ˆï¼Œå¯ä»¥è¯´æŠŠ Google ä¸€ç›´åœ¨æ¨çš„ <strong><a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/">PRPL Patterns</a></strong> åšåˆ°äº†æè‡´ã€‚</p>
<p>ä»¥ä¸Šã€‚</p>

        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="/author//" style="background-image: url(/content/images/avatar_zbl.jpg)"><span class="hidden">cool4zbl's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="/author//">cool4zbl</a></h4>

                    <p>ğŸ‘¾ Front End =&gt; Back End =&gt; âˆ</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Beijing</span>
                    <span class="author-link icon-link"><a href="http://localhost:5000/author/ZBL">http://localhost:5000/author/ZBL</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Uber%20%E9%AB%98%E6%80%A7%E8%83%BD%20Web%20App%20%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5&amp;url=http://zhangbinliu.me/2017-07-10-m-uber-performance-optimazation/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://zhangbinliu.me/2017-07-10-m-uber-performance-optimazation/"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://zhangbinliu.me/2017-07-10-m-uber-performance-optimazation/"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


            <section itemprop="comment" class="post-comments">
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_config = function () {
                  this.page.url = 'http://zhangbinliu.me/2017-07-10-m-uber-performance-optimazation/';
                  this.page.identifier = '15';
                };
                var disqus_shortname = 'zblsdoodle';
                (function() { // DON'T EDIT BELOW THIS LINE
                  var d = document, s = d.createElement('script');
                  s.async = true;
                  s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
                })();
              </script>
            </section>

        </footer>

    </article>
</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://zhangbinliu.me">Doodles</a> &copy; 2017
            </section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a>
                &nbsp;&amp;&nbsp;
                <a href="https://github.com/cool4zbl/ghost-render">Ghost-render</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <script type="text/javascript" src="/assets/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- Baidu Statics -->
    <script>
        var _hmt = _hmt || []
            ; (function () {
                var hm = document.createElement('script')
                hm.src = 'https://hm.baidu.com/hm.js?0903b73655adcfdcf265110a12741a3c'
                var s = document.getElementsByTagName('script')[0]
                s.parentNode.insertBefore(hm, s)
            })()
    </script>
    <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-56185102-1', 'auto');
        ga('send', 'pageview');
    </script>

</body>

</html>